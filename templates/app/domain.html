{% load humanize %}
{% load timetags %}

<nav id="nav">
    <header>
        <h2>Domain</h2>
    </header>
    <ul>
        <!-- <li><a href="#">All Domains</a></li> -->
        {% for domain in domains.facet.buckets %}
        <li><a class="set-domain" data-key="{{domain.key}}" href="#">{{ domain.key|capfirst }} <span style='float:right'>({{ domain.doc_count|intcomma }})</span></a></li>
        {% endfor %}
    </ul>
</nav>

<div id="domain-sidebar">
    <nav>
        <header>
            <h2>{{ domain|capfirst }} by Team</h2>
        </header>
        <ul>
            {% for team in teams.facet.buckets %}
            <li><a class="filter-domain" data-field="team" data-key="{{team.key}}" href="#">{{ team.key|upper }} <span style='float:right'>({{ team.doc_count|intcomma }})</span></a></li>
            {% endfor %}
        {% if teams.sum_other_doc_count %}
            <li><a class="filter-domain" data-field="team" data-key="_other_" href="#">Other <span style='float:right'>({{ teams.sum_other_doc_count|intcomma }})</span></a></li>
        {% endif  %}
        {% if teams.sum_none_doc_count %}
            <li><a class="filter-domain" data-field="team" data-key="_none_" href="#">None <span style='float:right'>({{ teams.sum_none_doc_count|intcomma }})</span></a></li>
        {% endif  %}
        </ul>
    </nav>
    <nav>
        <header>
            <h2>{{ domain|capfirst }} by Crawler</h2>
        </header>
        <ul>
            {% for crawler in crawlers.facet.buckets %}
            <li><a class="filter-domain" data-field="crawler" data-key="{{crawler.key}}" href="#">{{ crawler.key|upper }} <span style='float:right'>({{ crawler.doc_count|intcomma }})</span></a></li>
            {% endfor %}
        {% if crawlers.sum_other_doc_count %}
            <li><a class="filter-domain" data-field="crawler" data-key="_other_" href="#">Other <span style='float:right'>({{ crawlers.sum_other_doc_count|intcomma }})</span></a></li>
        {% endif  %}
        {% if crawlers.sum_none_doc_count %}
            <li><a class="filter-domain" data-field="crawler" data-key="_none_" href="#">None <span style='float:right'>({{ crawlers.sum_none_doc_count|intcomma }})</span></a></li>
        {% endif  %}
        </ul>
    </nav>
</div>

<div id="content">
    <div class="inner">
        <article class="box post">
            <h2>{{ domain|capfirst }}</h2>
        </article>
        <section class="box search">
            <form id="search" method="post" action="#">
                <input type="text" class="text" name="query" placeholder="Search">
                <div style="float:right">Exact Match <input type="checkbox" name="exact"></div>
            </form>
        </section>

        <div id="sites">
        <h2>Sites</h2>
        <ul class="hosts">
        {% for site in sites.facet.buckets %}
        <li><a class="filter-domain" data-field="url.domain" data-key="{{ site.key }}" href="#">{{ site.key }}</a> ({{ site.doc_count|intcomma }})</li>
        {% endfor %}
        {% if sites.sum_other_doc_count %}
        <li><a class="filter-domain" data-field="url.domain" data-key="_other" href="#">Other</a> ({{ sites.sum_other_doc_count|intcomma }})</li>
        {% endif  %}
        {% if sites.sum_none_doc_count %}
        <li><a class="filter-domain" data-field="url.domain" data-key="_none_" href="#">None</a> ({{ sites.sum_none_doc_count|intcomma }})</li>
        {% endif  %}
        <li class="stretch"></li>
        </ul>
        </div>

        <div id="docs">
        {% if sites.docs %}
        <h2>Scrapes</h2>
        <p>
        {% if has_prev %}
        <a class="load-prev" href="#">&lt; previous</a>
        {% endif %}
        {% if has_next%}
        <a class="load-next" href="#">next &gt;</a>
        {% endif %}
        <span class="center">{{pageinfo.first|intcomma}}-{{pageinfo.last|intcomma}} of {{pageinfo.total|intcomma}}</span>
        </p>
        <table class="docs">
        <tr>
            <th>URL</th>
            <th>Timestamp</th>
            <th>Images</th>
            <th>Videos</th>
            <!--
            <th>Team</th>
            <th>Crawler</th>
            -->
            <th></th>
        </tr>
        {% for doc in sites.docs %}
        <tr data-id="{{doc.id}}">
            <td><a class="show-scrape" href="#" data-url="get/{{doc.type}}/{{doc.id}}" title="{{doc.fields.source.0.url}}">{{ doc.fields.source.0.url|truncatechars:72 }}</a></td>
            <td>{{ doc.fields.source.0.timestamp|ts }}</td>
            <td class="center">{% if doc.fields.source.0.images %}{{ doc.fields.source.0.images|length }}{% else %} 0 {% endif %}</td>
            <td class="center">{% if doc.fields.source.0.videos %}{{ doc.fields.source.0.videos|length }}{% else %} 0 {% endif %}</td>
            <!--
            <td>{{ doc.fields.source.0.team|upper }}</td>
            <td>{{ doc.fields.source.0.crawler|upper }}</td>
            -->
            <td><a href="{{doc.fields.source.0.url}}" target="_blank">visit</a></td>
        </tr>
        {% endfor %}
        </table>
        <p>
        {% if has_prev %}
        <a class="load-prev" href="#">&lt; previous</a>
        {% endif %}
        {% if has_next%}
        <a class="load-next" href="#">next &gt;</a>
        {% endif %}
        <span class="center">{{pageinfo.first|intcomma}}-{{pageinfo.last|intcomma}} of {{pageinfo.total|intcomma}}</span>
        </p>
        {% endif %}
        </div>
    </div>
</div>
